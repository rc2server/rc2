{
  "$schema" : "http://json-schema.org/draft-07/schema#",
  "$id" : "https://rc2.io/something",
  "title" : "Rc2 Compute Messages Outgoing to Appserver",
  "description" : "Messages to communicate with Rc2 compute engine",
  "type" : "object",
  "minProperties" : 2,
  "properties" : {
    "msg" : {
      "type" : "string",
      "description" : "the command to perform",
      "enum" : [
        "openresponse",
        "execComplete",
        "results",
        "showoutput",
        "variableupdate",
        "variablevalue",
        "help",
        "error",
        "envCreated",
        "previewInited",
        "previewUpdated",
        "previewUpdateStarted"

      ]
    },
    "argument" : {
      "type" : "string",
      "description" : "main argument for the command"
    }
  },
  "required" : [
    "msg",
    "argument"
  ],
  "oneOf" : [
    {
      "properties": {
        "msg": { "enum": ["open"] },
        "success": { "type" : "boolean"},
        "errorMessage": { "type": "string", "minimum": 0 }
      },
      "additionalProperties": false,
      "title": "Connection Open Response",
      "required": ["success"]
    },
    {
      "properties" : {
        "msg" : { "enum" : ["help"] },
        "topic" : { "type" : "string", "minLength" : 1 },
        "paths" :{
          "type": "array",
          "minLength" : 1,
          "items": [
            {
              "type": "string"
            }
          ]
        }
      },
      "title" : "Help",
      "description" : "Paths for Topic in Help"
    },
    {
      "properties" : {
        "msg" : {
          "enum" : ["variablevalue"]
        },
        "name" : {
          "type" : "string",
          "minLength" : 1
        },
        "value" : {
          "type" : "number",
          "multipleOf" : 1,
          "minimum" : 1
        },
        "contextId" : {
          "type" : "integer"
        },
        "startTime" : {
          "type" : "string",
          "pattern" : "^[0-9]*$",
          "title" : "start time of query in seconds since 1970"
        },
        "clientData" : {
          "type": "object",
          "properties": {
            "fileId": {
              "type": "number",
              "multipleOf": 1,
              "minimum": 1,
              "title": "id of the file to execute"
            },
            "fileVersion": {
              "type": "number",
              "multipleOf": 1,
              "minimum": 1,
              "title": "version of the file to execute"
            }
          }
        },
        "clientIdent" : {
          "type": "string",
          "minLength": 1
        }
      },
      "title" : "VariableValue",
      "description" : "Response from a Get Variable Command"
    },
    {
      "properties": {
        "msg": {
          "enum": [
            "variableupdate"
          ]
        },
        "delta": {
          "type": "boolean"
        },
        "variables": {
          "type": "array",
          "minLength": 1,
          "items": [
            {
              "type": "string"
            }
          ]
        },
        "variablesAdded": {
          "type": "array",
          "minLength": 1,
          "items": [
            {
              "type": "string"
            }
          ]
        },
        "variablesRemoved": {
          "type": "array",
          "minLength": 1,
          "items": [
            {
              "type": "string"
            }
          ]
        },
        "contextId": {
          "type": "integer"
        },
        "clientData": {
          "type": "array",
          "minLength": 1,
          "items": [
            {
              "type": "string"
            }
          ]
        }
      },
      "title": "variableUpdate",
      "description": "Response from a list of variables.  Also sent when the client is watching for changes."
    },
    -----STOP 2021-02-01

    {
    },
    "contextId" : {
      "type" : "integer"
    },
    "startTime" : {
      "type" : "string",
      "pattern" : "^[0-9]*$",
      "title" : "start time of query in seconds since 1970"
    },
    "clientData" : {
      "type": "object",
      "properties": {
        "fileId": {
          "type": "number",
          "multipleOf": 1,
          "minimum": 1,
          "title": "id of the file to execute"
        },
        "fileVersion": {
          "type": "number",
          "multipleOf": 1,
          "minimum": 1,
          "title": "version of the file to execute"
        }
      }
    },
    "clientIdent" : {
      "type": "string",
      "minLength": 1
    }
    },
    "title" : "VariableValue",
    "description" : "Response from a Get Variable Command"
    },
    {
      "properties" : {
        "argument" : {
          "type" : "string",
          "maxLength" : 0
        },
        "msg" : {
          "enum" : ["saveEnv"]
        }
      },
      "title" : "Save Environment"
    },
    ,
    "title" : "Execute Script",
    "required" : [
      "queryId"
    ]
    },
    {
      "properties" : {
        "msg" : {
          "enum" : ["execAndReturn"]
        },
        "argument" : {
          "type" : "string",
          "minLength" : 1
        },
        "queryId" : {
          "type" : "number",
          "multipleOf" : 1,
          "minimum" : 1
        },
        "startTime" : {
          "type" : "string",
          "pattern" : "^[0-9]*$",
          "title" : "start time of query in seconds since 1970"
        },
        "contextId" : {
          "type" : "integer"
        }
      },
      "title" : "Execute and Return Object",
      "description" : "execute and returns only an execComplete response with the result as a json object",
      "required" : [
        "queryId",
        "contextId"
      ]
    },
    {
      "properties" : {
        "msg" : {
          "enum" : ["execFile"]
        },
        "argument" : {
          "minLength" : 1,
          "pattern" : "^[0-9]+$",
          "title" : "file id as string"
        },
        "queryId" : {
          "type" : "number",
          "multipleOf" : 1,
          "minimum" : 1,
          "title" : "arbitrary id to link query to matching results"
        },
        "startTime" : {
          "type" : "string",
          "pattern" : "^[0-9]*$",
          "title" : "start time of query in seconds since 1970"
        },
        "clientData" : {
          "type" : "object",
          "properties" : {
            "fileId" : {
              "type" : "number",
              "multipleOf" : 1,
              "minimum" : 1,
              "title" : "id of the file to execute"
            },
            "fileVersopm" : {
              "type" : "number",
              "multipleOf" : 1,
              "minimum" : 1,
              "title" : "version of the file to execute"
            }
          },
          "patternProperties" : {
            "." : {
              "type" : "number",
              "multipleOf" : 1
            }
          },
          "title" : "Custom Data"
        }
      },
      "title" : "Execute File",
      "required" : [
        "queryId"
      ]
    },

    {
      "properties" : {
        "msg" : {
          "enum" : ["listVariables"]
        },
        "argument" : {
          "type" : "string",
          "maxLength" : 0
        },
        "delta" : {
          "type" : "boolean"
        },
        "contextId" : {
          "type" : "integer"
        }
      },
      "title" : "List Variables",
      "required" : [
        "delta"
      ]
    },
    {
      "properties" : {
        "argument" : {
          "type" : "string",
          "minLength" : 1
        },
        "msg" : {
          "enum" : ["getVariable"]
        },
        "clientData" : {
          "type" : "object",
          "patternProperties" : {
            "." : {
              "type" : "number",
              "multipleOf" : 1
            }
          }
        },
        "contextId" : {
          "type" : "integer"
        }
      },
      "title" : "Get Variable"
    },
    {
      "properties" : {
        "msg" : {
          "enum" : ["toggleVariableWatch"]
        },
        "argument" : {
          "type" : "string",
          "maxLength" : 0
        },
        "contextId" : {
          "type" : "integer"
        },
        "watch" : {
          "type" : "boolean"
        }
      },
      "additionalProperties" : false,
      "title" : "Toggle Variable Watch",
      "description" : "Toggle if Variable Changes are Being Watched",
      "required" : [
        "watch"
      ]
    },
    {
      "properties" : {
        "msg" : {
          "enum" : ["clearEnvironment"]
        },
        "argument" : {
          "type" : "string",
          "maxLength" : 0
        },
        "contextId" : {
          "type" : "integer"
        }
      },
      "title" : "Clear Environment",
      "description" : "Clears the argument specified as contextId, or the global environment"
    },
    {
      "properties" : {
        "msg" : {
          "enum" : ["createEnvironment"]
        },
        "argument" : {
          "type" : "string",
          "minLength" : 1
        }
      },
      "title" : "Create Environment"
    },
    {
      "properties" : {
        "msg" : {
          "enum" : ["initPreview"]
        },
        "argument" : {
          "type" : "string",
          "minLength" : 0
        },
        "fileId" : {
          "type" : "integer"
        },
        "updateIdentifier" : {
          "type" : "string",
          "minLength" : 1
        }
      },
      "title" : "Init Preview",
      "required" : [
        "fileId",
        "updateIdentifier"
      ]
    },
    {
      "properties" : {
        "msg" : {
          "enum" : ["updatePreview"]
        },
        "argument" : {
          "type" : "string",
          "minLength" : 0
        },
        "previewId" : {
          "type" : "integer",
          "minimum" : 1
        },
        "chunkId" : {
          "type" : "integer",
          "minimum" : 0
        },
        "includePrevious" : {
          "type" : "boolean"
        },
        "updateIdentifier" : {
          "type" : "string"
        }
      },
      "title" : "Update Preview",
      "description": "update specified preview. If chunkId is not specified, all chunks are updated",
      "required" : [
        "previewId"
      ]
    },
    {
      "properties" : {
        "msg" : {
          "enum" : ["removePreview"]
        },
        "argument" : {
          "type" : "string",
          "minLength" : 0
        },
        "previewId" : {
          "type" : "integer"
        }
      },
      "title" : "Remove Preview",
      "required" : [
        "previewId"
      ]
    }
  ]
}
